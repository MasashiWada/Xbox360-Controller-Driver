
//	HID Minidriver for Microsoft Xbox 360 Controller

#include	"driver.h"

//----------------------------------------------------------------------------------------------
//	Sin
//----------------------------------------------------------------------------------------------
LONG Sin( IN LONG Angle )
{
	//	ïœêîêÈåæ
	SHORT	SinTable[]	= {	 0x0000, 0x00c9, 0x0192, 0x025b, 0x0324, 0x03ed, 0x04b6, 0x057f
							,0x0647, 0x0710, 0x07d9, 0x08a2, 0x096a, 0x0a33, 0x0afb, 0x0bc3
							,0x0c8b, 0x0d53, 0x0e1b, 0x0ee3, 0x0fab, 0x1072, 0x1139, 0x1201
							,0x12c8, 0x138e, 0x1455, 0x151b, 0x15e2, 0x16a8, 0x176d, 0x1833
							,0x18f8, 0x19bd, 0x1a82, 0x1b47, 0x1c0b, 0x1ccf, 0x1d93, 0x1e56
							,0x1f19, 0x1fdc, 0x209f, 0x2161, 0x2223, 0x22e5, 0x23a6, 0x2467
							,0x2528, 0x25e8, 0x26a8, 0x2767, 0x2826, 0x28e5, 0x29a3, 0x2a61
							,0x2b1f, 0x2bdc, 0x2c98, 0x2d55, 0x2e11, 0x2ecc, 0x2f87, 0x3041
							,0x30fb, 0x31b5, 0x326e, 0x3326, 0x33de, 0x3496, 0x354d, 0x3604
							,0x36ba, 0x376f, 0x3824, 0x38d8, 0x398c, 0x3a40, 0x3af2, 0x3ba5
							,0x3c56, 0x3d07, 0x3db8, 0x3e68, 0x3f17, 0x3fc5, 0x4073, 0x4121
							,0x41ce, 0x427a, 0x4325, 0x43d0, 0x447a, 0x4524, 0x45cd, 0x4675
							,0x471c, 0x47c3, 0x4869, 0x490f, 0x49b4, 0x4a58, 0x4afb, 0x4b9e
							,0x4c3f, 0x4ce1, 0x4d81, 0x4e21, 0x4ebf, 0x4f5e, 0x4ffb, 0x5097
							,0x5133, 0x51ce, 0x5269, 0x5302, 0x539b, 0x5433, 0x54ca, 0x5560
							,0x55f5, 0x568a, 0x571d, 0x57b0, 0x5842, 0x58d4, 0x5964, 0x59f3
							,0x5a82, 0x5b10, 0x5b9d, 0x5c29, 0x5cb4, 0x5d3e, 0x5dc7, 0x5e50
							,0x5ed7, 0x5f5e, 0x5fe3, 0x6068, 0x60ec, 0x616f, 0x61f1, 0x6271
							,0x62f2, 0x6371, 0x63ef, 0x646c, 0x64e8, 0x6563, 0x65dd, 0x6657
							,0x66cf, 0x6746, 0x67bd, 0x6832, 0x68a6, 0x6919, 0x698c, 0x69fd
							,0x6a6d, 0x6adc, 0x6b4a, 0x6bb8, 0x6c24, 0x6c8f, 0x6cf9, 0x6d62
							,0x6dca, 0x6e30, 0x6e96, 0x6efb, 0x6f5f, 0x6fc1, 0x7023, 0x7083
							,0x70e2, 0x7141, 0x719e, 0x71fa, 0x7255, 0x72af, 0x7307, 0x735f
							,0x73b5, 0x740b, 0x745f, 0x74b2, 0x7504, 0x7555, 0x75a5, 0x75f4
							,0x7641, 0x768e, 0x76d9, 0x7723, 0x776c, 0x77b4, 0x77fa, 0x7840
							,0x7884, 0x78c7, 0x7909, 0x794a, 0x798a, 0x79c8, 0x7a05, 0x7a42
							,0x7a7d, 0x7ab6, 0x7aef, 0x7b26, 0x7b5d, 0x7b92, 0x7bc5, 0x7bf8
							,0x7c29, 0x7c5a, 0x7c89, 0x7cb7, 0x7ce3, 0x7d0f, 0x7d39, 0x7d62
							,0x7d8a, 0x7db0, 0x7dd6, 0x7dfa, 0x7e1d, 0x7e3f, 0x7e5f, 0x7e7f
							,0x7e9d, 0x7eba, 0x7ed5, 0x7ef0, 0x7f09, 0x7f21, 0x7f38, 0x7f4d
							,0x7f62, 0x7f75, 0x7f87, 0x7f97, 0x7fa7, 0x7fb5, 0x7fc2, 0x7fce
							,0x7fd8, 0x7fe1, 0x7fe9, 0x7ff0, 0x7ff6, 0x7ffa, 0x7ffd, 0x7fff };

	//	äpìxÇ 0 Å` 1023 Ç…ä€ÇﬂÇÈ
	Angle	= Angle % 1024;
	if( Angle < 0 )
	{
		Angle	+= 1024;
	}

	//	äpìxÇï‘Ç∑
	if( 0 <= Angle && Angle < 256 )
	{
		return( SinTable[ Angle ] );
	}
	if( 256 <= Angle && Angle < 512 )
	{
		return( SinTable[ 255 - ( Angle - 256 ) ] );
	}
	if( 512 <= Angle && Angle < 768 )
	{
		return( -SinTable[ Angle - 512 ] );
	} else {
		return( -SinTable[ 255 - ( Angle - 768 ) ] );
	}
}

//----------------------------------------------------------------------------------------------
//	Cos
//----------------------------------------------------------------------------------------------
LONG Cos( IN LONG Angle )
{
	return( Sin( Angle + 256 ) );
}

//----------------------------------------------------------------------------------------------
//	ATan2
//----------------------------------------------------------------------------------------------
LONG ATan2(
	 IN LONG	Y
	,IN LONG	X )
{
	//	ïœêîêÈåæ
	UCHAR	ATanTable[]	= {	 0x00, 0x00, 0x01, 0x01, 0x02, 0x03, 0x03, 0x04
							,0x05, 0x05, 0x06, 0x06, 0x07, 0x08, 0x08, 0x09
							,0x0a, 0x0a, 0x0b, 0x0c, 0x0c, 0x0d, 0x0d, 0x0e
							,0x0f, 0x0f, 0x10, 0x11, 0x11, 0x12, 0x13, 0x13
							,0x14, 0x14, 0x15, 0x16, 0x16, 0x17, 0x18, 0x18
							,0x19, 0x19, 0x1a, 0x1b, 0x1b, 0x1c, 0x1c, 0x1d
							,0x1e, 0x1e, 0x1f, 0x20, 0x20, 0x21, 0x21, 0x22
							,0x23, 0x23, 0x24, 0x24, 0x25, 0x26, 0x26, 0x27
							,0x27, 0x28, 0x29, 0x29, 0x2a, 0x2a, 0x2b, 0x2c
							,0x2c, 0x2d, 0x2d, 0x2e, 0x2f, 0x2f, 0x30, 0x30
							,0x31, 0x31, 0x32, 0x33, 0x33, 0x34, 0x34, 0x35
							,0x35, 0x36, 0x37, 0x37, 0x38, 0x38, 0x39, 0x39
							,0x3a, 0x3b, 0x3b, 0x3c, 0x3c, 0x3d, 0x3d, 0x3e
							,0x3e, 0x3f, 0x3f, 0x40, 0x41, 0x41, 0x42, 0x42
							,0x43, 0x43, 0x44, 0x44, 0x45, 0x45, 0x46, 0x46
							,0x47, 0x47, 0x48, 0x48, 0x49, 0x4a, 0x4a, 0x4b
							,0x4b, 0x4c, 0x4c, 0x4d, 0x4d, 0x4e, 0x4e, 0x4f
							,0x4f, 0x50, 0x50, 0x51, 0x51, 0x52, 0x52, 0x53
							,0x53, 0x53, 0x54, 0x54, 0x55, 0x55, 0x56, 0x56
							,0x57, 0x57, 0x58, 0x58, 0x59, 0x59, 0x5a, 0x5a
							,0x5b, 0x5b, 0x5b, 0x5c, 0x5c, 0x5d, 0x5d, 0x5e
							,0x5e, 0x5f, 0x5f, 0x5f, 0x60, 0x60, 0x61, 0x61
							,0x62, 0x62, 0x63, 0x63, 0x63, 0x64, 0x64, 0x65
							,0x65, 0x65, 0x66, 0x66, 0x67, 0x67, 0x68, 0x68
							,0x68, 0x69, 0x69, 0x6a, 0x6a, 0x6a, 0x6b, 0x6b
							,0x6c, 0x6c, 0x6c, 0x6d, 0x6d, 0x6e, 0x6e, 0x6e
							,0x6f, 0x6f, 0x6f, 0x70, 0x70, 0x71, 0x71, 0x71
							,0x72, 0x72, 0x72, 0x73, 0x73, 0x74, 0x74, 0x74
							,0x75, 0x75, 0x75, 0x76, 0x76, 0x76, 0x77, 0x77
							,0x77, 0x78, 0x78, 0x79, 0x79, 0x79, 0x7a, 0x7a
							,0x7a, 0x7b, 0x7b, 0x7b, 0x7c, 0x7c, 0x7c, 0x7d
							,0x7d, 0x7d, 0x7e, 0x7e, 0x7e, 0x7f, 0x7f, 0x7f, 0x7f };

	if( Y > 0 )
	{
		if( X > 0 )
		{
			if( X > Y )
			{
				return( ATanTable[ Y * 255 / X ] );
			} else {
				return( 127 - ATanTable[ X * 255 / Y ] + 128 );
			}
		} else {
			if( X == 0 )
			{
				return( 256 );
			}
			if( -X > Y )
			{
				return( 127 - ATanTable[ Y * 255 / -X ] + 384 );
			} else {
				return( ATanTable[ -X * 255 / Y ] + 256 );
			}
		}
	} else {
		if( X > 0 )
		{
			if( Y == 0 )
			{
				return( 0 );
			}
			if( X > -Y )
			{
				return( - ( ATanTable[ -Y * 255 / X ] ) );
			} else {
				return( - ( 127 - ATanTable[ X * 255 / -Y ] + 128 ) );
			}
		} else {
			if( Y == 0 )
			{
				return( -512 );
			}
			if( X == 0 )
			{
				return( -256 );
			}
			if( -X > -Y )
			{
				return( - ( 127 - ATanTable[ -Y * 255 / -X ] + 384 ) );
			} else {
				return( - ( ATanTable[ -X * 255 / -Y ] + 256 ) );
			}
		}
	}
}

//----------------------------------------------------------------------------------------------
//	Sqrt
//----------------------------------------------------------------------------------------------
LONGLONG Sqrt( IN LONGLONG X )
{
	//	ïœêîêÈåæ
	LONGLONG	S	= 1;
	LONGLONG	T	= X;

	if( X <= 0 )
	{
		return( 0 );
	}

	while( S < T )
	{
		S	<<= 1;
		T	>>= 1;
	}

	do
	{
		T	= S;
		S	= ( X / S + S ) >> 1;
	} while( S < T );

	return( T );
}
